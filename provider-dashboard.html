<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EarnLibr — Provider Dashboard</title>
  <style>
    :root {
      --bg:#0b0d17;
      --card:#0f1724;
      --accent1:#4a90e2;
      --accent2:#a3ff6e;
      --muted:#bfc7d6;
      --danger:#ef4444;
      --radius:12px;
      --glass: rgba(255,255,255,0.02);
      --glass2: rgba(255,255,255,0.015);
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family:Inter,system-ui,Arial; background: var(--bg); color:#eef2f7; min-height:100vh; }
    .wrap { max-width:1200px; margin:28px auto; padding:20px; display:grid; grid-template-columns: 1fr; gap:20px; position: relative; }
    .card { background: linear-gradient(180deg, var(--glass), var(--glass2)); border-radius:var(--radius); padding:18px; box-shadow:0 8px 30px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03); overflow:hidden; }
    .sidebar { position: absolute; top:0; left:0; width:260px; z-index:100; height:100%; display:flex; flex-direction:column; gap:14px; transform: translateX(-100%); transition: transform 0.3s ease-in-out; background: var(--bg); padding-top:28px;}
    .sidebar.visible { transform: translateX(0); }
    .main { min-height:80vh; display:flex; flex-direction:column; gap:18px; grid-column:1 / -1; }
    #menuToggle { position: sticky; top:10px; z-index:110; width:40px; height:40px; display:flex; align-items:center; justify-content:center; margin-left:-8px; font-size:18px; color: var(--accent2); cursor:pointer; }
    .logo { display:flex; gap:12px; align-items:center; padding-bottom:8px; border-bottom:1px solid rgba(255,255,255,0.03);}
    .logo img { width:44px;height:44px;border-radius:8px; }
    .logo h2 { font-size:16px; margin:0; background:linear-gradient(90deg,var(--accent1),var(--accent2)); -webkit-background-clip:text; color:transparent; }
    .nav { margin-top:12px; display:flex; flex-direction:column; gap:8px; }
    .nav a { display:block; padding:10px 12px; border-radius:10px; text-decoration:none; color:var(--muted); font-weight:600; cursor:pointer; }
    .nav a.active, .nav a:hover { color:#041018; background:linear-gradient(90deg,var(--accent1),var(--accent2)); box-shadow:0 6px 18px rgba(32,90,255,0.08); }
    .profile { margin-top:auto; padding-top:10px; border-top:1px solid rgba(255,255,255,0.03); display:flex; flex-direction:column; gap:6px; }
    .avatar { width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2)); display:flex;align-items:center;justify-content:center;font-weight:700;color:#041018;font-size:18px; }
    .profile-info div { font-size:13px; color:var(--muted); }
    .profile-info strong { color:#fff; font-weight:700; }
    .top { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .greeting h1 { font-size:20px; margin:0; background:linear-gradient(90deg,var(--accent1),var(--accent2)); -webkit-background-clip:text; color:transparent; }
    .greeting p { margin:4px 0 0 0; color:var(--muted); font-size:13px; }
    .grid-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; margin-top:18px; }
    .grid-card { background:var(--card); border-radius:12px; padding:25px 15px; text-align:center; cursor:pointer; display:flex; flex-direction:column; align-items:center; justify-content:center; transition: transform 0.2s, box-shadow 0.2s; }
    .grid-card:hover { transform:translateY(-4px); box-shadow:0 6px 16px rgba(0,0,0,0.6); }
    .grid-card i { font-size:36px; margin-bottom:10px; color:var(--accent1); }
    .grid-card span { font-size:16px; font-weight:600; color:#eef2f7; text-align:center; }
    .btn { display:inline-block; padding:10px 12px; border-radius:10px; border:0; font-weight:700; cursor:pointer; background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#041018; text-decoration:none; }
    .muted { color:var(--muted); font-size:13px; }
  </style>
  <script src="https://kit.fontawesome.com/a2b6f38c57.js" crossorigin="anonymous"></script>
</head>
<body>

<div class="wrap">
  <div id="menuToggle"><i class="fas fa-bars"></i></div>

  <aside class="card sidebar" id="sidebar">
    <div class="logo">
      <img src="https://raw.githubusercontent.com/Carrew/Earnlibr-/refs/heads/main/1000115452-01.jpeg" alt="logo">
      <div>
        <h2>EarnLibr</h2>
        <div style="font-size:12px;color:var(--muted)">Provider Panel</div>
      </div>
    </div>
    <nav class="nav">
      <a id="nav-dashboard" class="active">Dashboard</a>
      <a id="nav-create-offer">Create Offer</a>
      <a id="nav-deals">Deals</a>
      <a id="nav-notifs">Notifications</a>
      <a id="nav-bills">Bills & Payments</a>
      <a id="nav-chat">Chat</a> <!-- NEW -->
    </nav>
    <div class="profile">
      <div class="avatar" id="avatar">P</div>
      <div class="profile-info">
        <div><strong id="providerName">Loading...</strong></div>
        <div id="providerEmail" class="muted">—</div>
        <div id="providerRole">—</div>
        <div id="providerPhone">—</div>
        <div id="providerCountry">—</div>
        <div id="providerReferral">—</div>
        <div id="providerCreated">—</div>
      </div>
      <div style="margin-top:6px"><button id="logoutBtn" class="btn" style="padding:8px 10px;">Logout</button></div>
    </div>
  </aside>

  <main class="main card">
    <div class="top">
      <div class="greeting">
        <h1 id="greet">Welcome back</h1>
        <p id="subg" class="muted">Here's a quick overview of your activity on EarnLibr.</p>
      </div>
      <div style="display:flex; gap:12px;">
        <a id="createOfferBtn" class="btn">Create Offer</a>
      </div>
    </div>

    <!-- Grid Cards -->
    <div class="grid-cards">
      <div class="grid-card" onclick="navigate('providers-create-offer.html')"><i class="fas fa-plus-circle"></i><span>Create Offer</span></div>
      <div class="grid-card" onclick="navigate('providers-deals-management.html')"><i class="fas fa-briefcase"></i><span>Deals</span></div>
      <div class="grid-card" onclick="navigate('provider-notification.html')"><i class="fas fa-bell"></i><span>Notifications</span></div>
      <div class="grid-card" onclick="navigate('providers-bills.html')"><i class="fas fa-file-invoice-dollar"></i><span>Bills & Payments</span></div>
      <div class="grid-card" onclick="navigate('provider-chat.html')"><i class="fas fa-comments"></i><span>Chat</span></div> <!-- NEW -->
    </div>
  </main>
</div>

<script type="module">
import { auth } from "./firebase.js";
import { signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

// Sidebar toggle
const sidebar = document.getElementById('sidebar');
const menuToggle = document.getElementById('menuToggle');
menuToggle.addEventListener('click', ()=>{
  sidebar.classList.toggle('visible');
  menuToggle.querySelector('i').className = sidebar.classList.contains('visible') ? 'fas fa-times' : 'fas fa-bars';
});

// Navigation
function navigate(url){ sidebar.classList.remove('visible'); menuToggle.querySelector('i').className='fas fa-bars'; window.location.href=url; }
const navLinks = {
  'nav-dashboard':'provider-dashboard.html',
  'nav-create-offer':'providers-create-offer.html',
  'nav-deals':'providers-deals-management.html',
  'nav-notifs':'provider-notification.html',
  'nav-bills':'providers-bills.html',
  'nav-chat':'provider-chat.html', // NEW
  'createOfferBtn':'providers-create-offer.html'
};
Object.keys(navLinks).forEach(id=>{
  const el=document.getElementById(id);
  if(el) el.addEventListener('click',()=>navigate(navLinks[id]));
});
document.querySelectorAll('.grid-card').forEach(card=>{
  card.addEventListener('click',()=>navigate(card.getAttribute('onclick').match(/'([^']+)'/)[1]));
});

// Logout
document.getElementById('logoutBtn').addEventListener('click', async ()=>{
  await signOut(auth);
  localStorage.removeItem('userSession');
  window.location.href='login.html';
});

// Load session & enforce provider role
const sessionRaw = localStorage.getItem('userSession');
if(!sessionRaw){ window.location.href='login.html'; throw new Error('No session'); }
const session = JSON.parse(sessionRaw);
if(session.role!=='provider'){ window.location.href='login.html'; throw new Error('Unauthorized'); }

// Populate profile UI
const avatarEl = document.getElementById('avatar');
document.getElementById('providerName').textContent = session.name;
document.getElementById('providerEmail').textContent = session.email;
document.getElementById('providerRole').textContent = `Role: ${session.role}`;
document.getElementById('providerPhone').textContent = session.phone||'—';
document.getElementById('providerCountry').textContent = session.country||'—';
document.getElementById('providerReferral').textContent = `Referral: ${session.referralCode||'—'}`;
document.getElementById('providerCreated').textContent = `Joined: ${session.createdAt||'—'}`;
avatarEl.textContent = session.name.charAt(0).toUpperCase();
document.getElementById('greet').textContent = `Welcome back, ${session.name}`;
</script>
</body>
</html>
