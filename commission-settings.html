<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin — Platform Commission Settings</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b0d17;
      color: #eef2f7;
      margin: 0;
      padding: 20px;
    }
    h1 {
      background: linear-gradient(90deg, #4ade80, #22d3ee);
      -webkit-background-clip: text;
      color: transparent;
      margin-bottom: 20px;
    }
    .container {
      background: #0f1724;
      border-radius: 12px;
      padding: 20px;
      max-width: 400px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: none;
      margin-bottom: 15px;
      background: #1a2235;
      color: #eef2f7;
    }
    button {
      padding: 10px 15px;
      border-radius: 6px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      background: #4ade80;
      color: #041018;
      transition: 0.3s;
    }
    button:hover { opacity: 0.9; }
    .notif {
      background: #1a2235;
      border-left: 4px solid #4ade80;
      color: #a3ff6e;
      padding: 10px;
      margin-top: 15px;
      border-radius: 8px;
      display: none;
    }
  </style>
</head>
<body>
  <h1>Platform Commission Settings</h1>
  <div class="container">
    <label for="commissionInput">Commission Percentage (%)</label>
    <input type="number" id="commissionInput" min="0" max="100" step="0.1" />
    <button id="saveBtn">Save Commission</button>
    <div id="notif" class="notif"></div>
  </div>

  <script type="module">
    import { db } from './firebase.js';
    import { ref, get, update } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js';

    const commissionInput = document.getElementById('commissionInput');
    const saveBtn = document.getElementById('saveBtn');
    const notif = document.getElementById('notif');

    const showNotif = (msg, type='success') => {
      notif.textContent = msg;
      notif.style.display = 'block';
      notif.style.borderLeft = type === 'error' ? '4px solid #ef4444' : '4px solid #4ade80';
      setTimeout(() => notif.style.display = 'none', 4000);
    };

    const commissionRef = ref(db, 'platform-settings/commission');

    // Load current commission
    const loadCommission = async () => {
      try {
        const snapshot = await get(commissionRef);
        if (snapshot.exists()) {
          commissionInput.value = snapshot.val().percentage || 20;
        } else {
          commissionInput.value = 20; // default
        }
      } catch (err) {
        console.error(err);
        showNotif('Error loading commission: ' + err.message, 'error');
      }
    };

    loadCommission();

    // Save commission
    saveBtn.onclick = async () => {
      const percentage = parseFloat(commissionInput.value);
      if (isNaN(percentage) || percentage < 0 || percentage > 100) {
        showNotif('Enter a valid percentage (0-100)', 'error');
        return;
      }

      try {
        await update(commissionRef, {
          percentage,
          lastUpdated: new Date().toISOString()
        });
        showNotif(`✅ Commission updated to ${percentage}%`);
      } catch (err) {
        console.error(err);
        showNotif('Error updating commission: ' + err.message, 'error');
      }
    };
  </script>
</body>
</html>
